<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Client Cost Details</title>
     <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Cost Details for Client: {{ cost_details.client.title() }}</h1>

    <form method="POST">
        <div class="input-group" style="width:400px;">
          <select class="form-select" name="month" id="month" aria-label="Example select with button addon">
            <option selected>Select Month:</option>
                {% for i in range(1, 13) %}
                    <option value="{{ i }}" {% if i == month %}selected{% endif %}>{{ i }}</option>
                {% endfor %}
          </select>
          <button class="btn btn-outline-primary" type="submit">Filter Month</button>
        </div>
    </form>

    <div class="card mb-4">
      <h5 class="card-header">Total Cost: {{ cost_details.total_cost }} USD</h5>
      <div class="card-body">
        <h5 class="card-title">Task Breakdown:</h5>
        <ul class="list-group list-group-flush">
            {% for task in cost_details.tasks %}
                <li class="list-group-item">
                    <strong>{{ task.category }} - {{ task.task_name }}:</strong>
                    {{ task.message_count }} messages, {{ task.total_cost }} USD
                </li>
            {% endfor %}
        </ul>
      </div>
    </div>

    <div class="card mb-4">
        <h5 class="card-header">Drill Down by User</h5>
        <div class="card-body">
            <div class="accordion accordion-flush mb-2" id="accordionFlushExample">
              {% for task in cost_details.tasks %}
                  <div class="accordion-item-{{loop.index}}">
                    <h2 class="accordion-header" id="flush-heading-{{loop.index}}">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse-{{loop.index}}" aria-expanded="false" aria-controls="flush-collapseOne">
                        Task: {{ task.task_name }} (Category: {{ task.category }})
                      </button>
                    </h2>
                    <div id="flush-collapse-{{loop.index}}" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                      <div class="accordion-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">Messages: {{ task.message_count }}</li>
                            <li class="list-group-item">Total Cost: {{ task.total_cost }}</li>
                            <li class="list-group-item">User Email: {{ task.user_email }}</li>
                        </ul>
                      </div>
                    </div>
                  </div>
              {% endfor %}
            </div>
        </div>
    </div>

    <div class="alert alert-primary" role="alert">
      <a href="{{ url_for('index') }}" class="alert-link">Back to Client List</a>
    </div>

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>
